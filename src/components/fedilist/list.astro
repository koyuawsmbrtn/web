---
import list from "../../json/instances.json";
import moderationMaps from "../../json/mmaps.json";

function getMod(s) {
  let r = s;
  moderationMaps.forEach(e => {
    if (s.startsWith("%%") && e.name == s.replaceAll("%%", "")) {
      r = e.text;
    }
  });
  return r;
}

function removeSub(s) {
  let p = s.split(".");
  if (p.length == 3) {
    return `${p[1]}.${p[2]}`;
  }
}
---

<table>
  <tr>
    <th>
      <strong>Instance</strong>
    </th>
    <th>
      <strong>Description</strong>
    </th>
    <th>
      Moderation policies
    </th>
    <th>
      <strong>Special</strong> kinks
    </th>
    <th>
      Instance banner/logo/admin icon
    </th>
  </tr>
  {list.map((e) => (
    <tr>
      <td>
        <a href={`https://${e.instance}`} target="_blank" rel="nofollow">{e.instance}</a>
      </td>
      <td>
        {e.description}
      </td>
      <td>
        {getMod(e.moderation)}
      </td>
      <td>
        {e.special}
      </td>
      <td>
        <img style="width: 150px" src={e.logo} alt={`${removeSub(e.instance)} Logo`} />
      </td>
    </tr>
  ))}
</table>